<form id="createTask">
	<fieldset>
		<legend>Create a Task</legend>
		<h4>* = Required</h4>
		<label for="name">Task Name: * </label>
		<input type="text" id="name" required />
		<label for="requester">Requester: * </label>
		<input type="email" id="requester" required />
		<label for="requester">Due Date: * </label>
		<input type="datetime" id="dueDate" required />
		<label for="requester">Owner: * </label>
		<input type="email" id="owner" required />
		<label for="requester">Creator: * </label>
		<input type="email" id="creator" required />
		<label for="requester">Assignee: * </label>
		<input type="email" id="assignee" required />
		<label for="priority">Priority: * </label>
		<input type="text" id="priority" required />
		<label for="documentUpload">Add Document: * </label>
		<input id="documentUpload" type="file" name="documentUpload" required />
		<button class="btn" type="Submit" id="postTask">Upload a new task!</button>
	</fieldset>
</form>

<!-- Call jQuery libraries -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

<script>
$(function() {
	var name = $( "#name" ),
	requester = $( "#requester" ),
	dueDate = $( "#dueDate" ),
	owner = $( "#owner" ),
	creator = $( "#creator" ),
	assignee = $( "#assignee" ),
	priority = $( "#priority" ),
	createTaskForm = $( "#createTask" ),
	submitButton = $( "#postTask" ),
	postObject = {};
	
	function onFailure(return_obj) {
		console.log(return_obj.message);
        submitButton.prop("disabled",false);
	}
	
	function onSuccessCreate(return_obj) {
		$(':input','#createTask').not(':button, :submit, :reset, :hidden')
								 .val('')
								 .removeAttr('checked')
								 .removeAttr('selected');
		submitButton.prop("disabled",false);
		console.log(return_obj[0].objectId);
	}
	
	function onSuccessUpload(return_obj) {
		postObject.Name = name.val();
		postObject.Requester = requester.val();
		postObject.DueDate = dueDate.val();
		postObject.Owner = owner.val();
		postObject.Creator = creator.val();
		postObject.Assignee = assignee.val();
		postObject.Priority = priority.val();
        postObject.FileUrl = return_obj[1];
        postObject.FileName = return_obj[0];
		google.script.run.withSuccessHandler(onSuccessCreate)
	                     .withFailureHandler(onFailure)
	                     .postTask(postObject);
	}
	
	submitButton.click(function(event) {
		event.preventDefault();
        $(this).prop("disabled",true);
        
		google.script.run.withSuccessHandler(onSuccessUpload)
	                     .withFailureHandler(onFailure)
	                     .uploadFile(document.getElementById("createTask"));
	});
});
</script>
