<script>
// This code in this function runs when the page is loaded.
var userEmailAddress = '';
var today = new Date();
$(function() {
  //google.script.run.withSuccessHandler(createTable).getMyCreatedTasks("mycreated", "createDate", "desc");
  $( "#my_queue_view_selection" ).data("queueViewSelection", {owned: "all", assigned: "all", search: "all"});
  $( '#include_archived_checkbox' ).data("archCheckboxOnOff", {owned: false, assigned: false, search: true});
  loadMyCreatedDataTable();
  createTableFilter($( "#my_tasks_filter" ), $( "#data_table" ), "" , [], 9, "moreinfo");
  //google.script.run.withSuccessHandler(createTable).getMyCreatedTasks("myassigned", "dueDate", "asc");
  loadMyAssignedDataTable();
  createTableFilter($( "#my_assignments_filter" ), $( "#my_assigned_data_table" ), "" , [], 9, "moreinfo");
  google.script.run.createUserPreferenceObject();
  var currentUserEmail = google.script.run.withSuccessHandler(alertMe).getUserEmailAddress();
  
//** View Choosing *****//
  $( "#my_queue_view_selection" ).change(function(event) {
    //Reset Text Filters
    $( "#my_tasks_filter" ).val('');
    $( "#my_assignments_filter" ).val('');
    $( '#include_archived_checkbox' ).prop('disabled', false);
    var include_archived_flag = false;
      if($( '#include_archived_checkbox' ).prop('checked')===true){
        include_archived_flag = true;
      }
    var view_flag = $( "#my_queue_view_selection" ).data("reportTab");
    if(view_flag==="mycreated"){ 
      var $tableSelector = $( "#data_table" );
    } else if(view_flag==="myassigned") { 
      $tableSelector = $( "#my_assigned_data_table" );
    } else if(view_flag==="search") {
      $tableSelector = $( "#search_results_table, #search_results_assignee_table" );
    }
    
    //Filter the table rows
    var search_term = ""
    var colIndex = -1;
    //$tableToFilter.find("tbody").find("tr").hide();
    $tableSelector.find("tbody").find("tr").hide().addClass("filtered-tr-dropdown").removeClass("viewable-tr");
    
    //All Tasks
    if($(this).val()==='all'){
      //Archived Toggle
      $( '#include_archived_checkbox' ).show().next().show();
      if(include_archived_flag===true){
        $tableSelector.find("tbody").find("tr").show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
      } else {
        $tableSelector.find("tbody").find("tr").siblings().not('.archived').show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
      }      
    }    
    //Overdue
    else if($(this).val()==='overdue'){
      //Archived Toggle
      $( '#include_archived_checkbox' ).hide().next().hide();
      
      search_term = "Overdue"; colIndex = 2;
      //Search Text Inside of HTML Table
      $tableSelector.find("tbody").find("tr").each(function( index ) {
        if($(this).find("td").eq(colIndex).find(".alert").find("span").eq(1).text()===search_term){
          //if(include_archived_flag===true){
            //$(this).closest( "tr" ).show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
          //} else {
            $(this).closest( "tr" ).not('.archived').show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
          //}
        }
      });
    } 
    //Not Started
    else if($(this).val()==='not_started'){
      //Archived Toggle
      $( '#include_archived_checkbox' ).hide().next().hide();
      
      search_term = "ns"; colIndex = 6;
      //Search Text Inside of HTML Table
      $tableSelector.find("tbody").find("tr").each(function( index ) {
        if($(this).find("td").eq(colIndex).find(".working-status-field").val()===search_term){
          //if(include_archived_flag===true){
            //$(this).closest( "tr" ).show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
          //} else {
            $(this).closest( "tr" ).not('.archived').show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
          //}
        }
      });
    }
    //Started
    else if($(this).val()==='started'){
      //Archived Toggle
      $( '#include_archived_checkbox' ).hide().next().hide();
      
      search_term = "sd"; colIndex = 6;
      //Search Text Inside of HTML Table
      $tableSelector.find("tbody").find("tr").each(function( index ) {
        if($(this).find("td").eq(colIndex).find(".working-status-field").val()===search_term){
          //if(include_archived_flag===true){
            //$(this).closest( "tr" ).show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
          //} else {
            $(this).closest( "tr" ).not('.archived').show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
          //}
        }
      });
    }
    //Complete
    else if($(this).val()==='complete'){
      //Archived Toggle
      $( '#include_archived_checkbox' ).hide().next().hide();
      
      
      search_term = "cp"; colIndex = 6;
      //Search Text Inside of HTML Table
      $tableSelector.find("tbody").find("tr").each(function( index ) {
        if($(this).find("td").eq(colIndex).find(".working-status-field").val()===search_term){
          //$(this).closest( "tr" ).show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
          $(this).closest( "tr" ).not('.archived').show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
        }
      });
    }
    //Archived
    else if($(this).val()==='archived'){
      //Archived Toggle
      $( '#include_archived_checkbox' ).hide().next().hide();
      
      search_term = "ar"; colIndex = 6;
      //Search Text Inside of HTML Table
      $tableSelector.find("tbody").find("tr").each(function( index ) {
        if($(this).hasClass('archived')){
          $(this).closest( "tr" ).show().removeClass("filtered-tr-dropdown").addClass("viewable-tr");
        }
      });
    }
    
    if(view_flag==="mycreated"){ 
      updateQueueCount($tableSelector.find("tbody").find("tr:visible").length, $( "#go_my_tasks" ), "My Tasks");
    } else if(view_flag==="myassigned") { 
      updateQueueCount($tableSelector.find("tbody").find("tr:visible").length, $( "#go_my_assigned" ), "My Assignments");
    }
  });
  
//** Archived Checkbox *****//
  $( '#include_archived_checkbox' ).click(function(){
    var view_flag = $( "#my_queue_view_selection" ).data("reportTab");
    if(view_flag==="mycreated"){ 
      var $tableSelector = $( "#data_table" );
    } else if(view_flag==="myassigned") { 
      $tableSelector = $( "#my_assigned_data_table" );
    } else if(view_flag==="search") {
      $tableSelector = $( "#search_results_table, #search_results_assignee_table" );
    }
    
    if($(this).prop('checked')===true){
      $tableSelector.find("tbody").find(".archived").show();
    } else {
      $tableSelector.find("tbody").find(".archived").hide();
    }
    
    if(view_flag==="mycreated"){ 
      updateQueueCount($tableSelector.find("tbody").find("tr:visible").length, $( "#go_my_tasks" ), "My Tasks");
    } else if(view_flag==="myassigned") { 
      updateQueueCount($tableSelector.find("tbody").find("tr:visible").length, $( "#go_my_assigned" ), "My Assignments");
    }
  });
  
//** Select ALL *****//
$( "#data_table, #my_assigned_data_table, #search_results_table, #search_results_assignee_table" ).on('click', '.select_all_cb', function(event) {
    var check_group = $(this).closest('table').find('tbody').find('.select_task_checkbox:visible'); 
    var check_group_checked = check_group.prop('checked');
    var numChecked = 0;
        
    if($(this).prop('checked')===false){
      //Disable Stuff
      
      $(this).closest('table').find('tbody').find('.select_task_checkbox').prop('checked', false);
      numChecked = $(this).closest('table').find('tbody').find('.select_task_checkbox:checked').length;
    } else {
      //Enable Stuff
      
      $(this).closest('table').find('tbody').find('.select_task_checkbox:visible').prop('checked', true); 
      numChecked = $(this).closest('table').find('tbody').find('.select_task_checkbox:checked:visible').length;
    }
  });

//** Select SOME *****//

$( "#data_table, #my_assigned_data_table, #search_results_table, #search_results_assignee_table" ).on('click', '.select_task_checkbox, .select_all_cb' , function(event){
      var check_group = $(this).closest('table').find('tbody').find('.select_task_checkbox:checked:visible');

      if($(this).closest('table').attr("id")==="data_table") { //MY OWNED / CREATED
        //var check_group = $(this).closest('table').find('tbody').find('.select_task_checkbox:checked:visible');
        var numComplete = 0;
        check_group.each(function(i){ //<-- Check if there are some incompletes that cannot be archived
          if($(this).parent().closest('tr').find( ".working-status-field" ).val()==='cp'){ numComplete++; } 
        });
            
        if(check_group.length < 1){
          //Export
          $( "#export_menu_btn" ).parent().next().find("li").eq(1).addClass("ui-state-disabled"); $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(1).text("Export Selected Tasks that I Own");   
          //Edit -> Delete
          $( "#edit_menu_btn" ).parent().next().find("li").eq(0).addClass("ui-state-disabled"); $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(0).html("<span class='ui-icon ui-icon-trash'></span>Delete");
          //Edit -> Archive selected
          $( "#edit_menu_btn" ).parent().next().find("li").eq(2).addClass("ui-state-disabled"); $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(2).html("<span class='ui-icon ui-icon-calculator'></span>Archive Select Completed Tasks");
          //Edit -> Copy selected
          $( "#edit_menu_btn" ).parent().next().find("li").eq(3).addClass("ui-state-disabled"); $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(3).html("<span class='ui-icon ui-icon-copy'></span>Copy Selected Tasks");
        } else {
          //Export
          $( "#export_menu_btn" ).parent().next().find("li").eq(1).removeClass("ui-state-disabled");
          //Edit -> Delete
          $( "#edit_menu_btn" ).parent().next().find("li").eq(0).removeClass("ui-state-disabled");
          //Edit -> Copy
          $( "#edit_menu_btn" ).parent().next().find("li").eq(3).removeClass("ui-state-disabled");
          //Edit -> Archive selected         
          if(numComplete===check_group.length){
              $( "#edit_menu_btn" ).parent().next().find("li").eq(2).removeClass("ui-state-disabled");
          } else {
              $( "#edit_menu_btn" ).parent().next().find("li").eq(2).addClass("ui-state-disabled");
          }
            
          if(check_group.length == 1){
            //Export
            $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(1).text("Export Selected Task that I Own");
            //Edit -> Delete
            $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(0).html("<span class='ui-icon ui-icon-trash'></span>Delete Task");
            //Edit -> Copy
            $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(3).html("<span class='ui-icon ui-icon-copy'></span>Copy Task");
            //Edit -> Archive Selected
            if(numComplete===check_group.length){
              $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(2).html("<span class='ui-icon ui-icon-calculator'></span>Archive Completed Task");
            } else {
              $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(2).html("<span class='ui-icon ui-icon-calculator'></span>Archive Select Completed Tasks");
            }
          } else {
            //Export
            $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(1).text("Export (" + check_group.length + ") Selected Tasks that I Own");
            //Edit -> Delete
            $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(0).html("<span class='ui-icon ui-icon-trash'></span>Delete (" + check_group.length + ") Tasks");
            //Edit -> Copy
            $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(3).html("<span class='ui-icon ui-icon-copy'></span>Copy (" + check_group.length + ") Tasks");
            //Edit -> Archive Selected
            if(numComplete===check_group.length){
              $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(2).html("<span class='ui-icon ui-icon-calculator'></span>Archive (" + numComplete + ") Completed Tasks");
            } else {
              $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(2).html("<span class='ui-icon ui-icon-calculator'></span>Archive Select Completed Tasks");
            }         
          }
        }
      } else if($(this).closest('table').attr("id")==='my_assigned_data_table'){ // MY ASSIGNED
        //var check_group = $('[name=assigned_rowid]:checked');
          
        if(check_group.length < 1){
          //Export
          $( "#export_menu_btn" ).parent().next().find("li").eq(3).addClass("ui-state-disabled"); $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(3).text("Export Selected Tasks Assigned to Me");
          //Edit -> Copy selected
          $( "#edit_menu_btn" ).parent().next().find("li").eq(3).addClass("ui-state-disabled"); $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(3).html("<span class='ui-icon ui-icon-copy'></span>Copy Selected Tasks");
        } else {
          //Export
          $( "#export_menu_btn" ).parent().next().find("li").eq(3).removeClass("ui-state-disabled");
          //Edit -> Copy
          $( "#edit_menu_btn" ).parent().next().find("li").eq(3).removeClass("ui-state-disabled");
            
          if(check_group.length == 1){
            //Export
            $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(3).text("Export Selected Task Assigned to Me");
            //Edit -> Copy
            $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(3).html("<span class='ui-icon ui-icon-copy'></span>Copy Task");
          } else {
            //Export
            $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(3).text("Export (" + check_group.length + ") Selected Tasks Assigned to Me");
            //Edit -> Copy
            $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(3).html("<span class='ui-icon ui-icon-copy'></span>Copy (" + check_group.length + ") Tasks");
          }
        }
      } else if($(this).closest('table').attr("id")==='search_results_table' || $(this).closest('table').attr("id")==='search_results_assignee_table'){ // SEARCH > CRATED/OWNED or SEARCH > MY ASSIGNED
        //var check_group = $('[name=search_rowid]:checked');
        
        var search_check_group1_length = $( "#search_results_table" ).find('tbody').find('.select_task_checkbox:checked:visible').length;
        var search_check_group2_length = $( "#search_results_assignee_table" ).find('tbody').find('.select_task_checkbox:checked:visible').length;
        var search_check_group_length = search_check_group1_length+search_check_group2_length;
          
        if(search_check_group_length < 1){
          //Export
          $( "#export_menu_btn" ).parent().next().find("li").eq(5).addClass("ui-state-disabled"); $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(5).text("Export Selected Tasks");
        } else {
          //Export
          $( "#export_menu_btn" ).parent().next().find("li").eq(5).removeClass("ui-state-disabled");
          
          if(search_check_group_length == 1){
            //Export
            $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(5).text("Export Selected Task");
          } else {
            //Export
            $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(5).text("Export (" + search_check_group_length + ") Selected Tasks");
          }
        }
      }
    });  
//** Sorting function *****//  
  $( "#data_table th:gt(0):lt(7), #my_assigned_data_table th:gt(0):lt(7), #search_results_assignee_table th:gt(0):lt(7), #search_results_table th:gt(0):lt(7)" ).css("cursor", "pointer");
  $( "#data_table, #my_assigned_data_table, #search_results_assignee_table, #search_results_table" ).on('click', 'th:gt(0):lt(7)', function(event) { 
    //Task Name & Description = 1	Due Date = 2	Owner(s) = 3	Assignee(s)	Priority = 4	Working Status = 5	
    //Total Hours = 6	Documents = 7	More = 8
    var column_to_sort = $(this).index();
    var sort_data = new Array();
    var sorted_data = new Array();
    var table_rows_array = new Array();
    
    //$(this).closest('table').find('tbody').html();
    
    $(this).closest('table').find('tbody').find('tr').each(function(i){
      var rowHtml = '<tr>' + $(this).html() + '</tr>';
      //table_rows_array.push(rowHtml);
      table_rows_array.push($(this));
    });
    //alert(table_rows_array.length + ": " + table_rows_array);
    
    var viewTypeP = "";
    if($(this).closest('table').prop('id')==='data_table'){ viewTypeP = 'mycreated'; }
    else if($(this).closest('table').prop('id')==='my_assigned_data_table'){ viewTypeP = 'myassigned'; }
    else if($(this).closest('table').prop('id')==='search_results_assignee_table'){ viewTypeP = 'searchassignee'; }
    else if($(this).closest('table').prop('id')==='search_results_table'){ viewTypeP = 'searchcreateown'; }
    
    //** Do some sorting 
    //Task Name = 1  Description = 19	Due Date = 2	Owner(s) = 13	Assignee(s) = 3 	Priority = 4 	Working Status = 5 	
    //Total Hours = 12	Documents = 6	
    
    if(column_to_sort===1) { //1. Sort by Name
      //sorted_data = sortColumnAlphabetically($(this), 1, sort_data);
      sorted_data = sortTaskNameColumn($(this), 1, table_rows_array);
    } else if(column_to_sort===2) { //2. Due Date
      sorted_data = sortDueDateColumn($(this), 2, table_rows_array);
    } else if (column_to_sort===3) { //3. Owners
      sorted_data = sortOwnersColumn($(this), 20, table_rows_array);
    } else if (column_to_sort===4) { //4. Assignee Lead
      sorted_data = sortAssigneesColumn($(this), 18, table_rows_array);
    } else if (column_to_sort===5) { //5. Priority
      sorted_data = sortPriorityColumn($(this), 4, table_rows_array);
    } else if (column_to_sort===6) { //6. Status
      sorted_data = sortStatusColumn($(this), 5, table_rows_array);
    } else if (column_to_sort===7) { //7. Hours
      sorted_data = sortHoursColumn($(this), 12, table_rows_array);
    }
    
    $(this).closest('table').find('thead').find('th').filter(':gt(0):lt(7)').each(function(i){
      if(column_to_sort!==i+1) {
        $(this).removeClass("th-sort-asc th-sort-desc").addClass("th-sort-default");
        $(this).find("div").eq(1).remove();
        $(this).find("div").after('<div style="height: 16px; width: 10%; float: right; text-align: right;"></div>');
      }
    });
  });
/** End Sort Function *****/

});

function updateQueueCount(count, $queueTab, label) {
    $queueTab.text(label + " (" + count + ")"); 
}

function sortTaskNameColumn($columnSelector, array_idx_to_sort_by, sort_data){
      if($columnSelector.hasClass("th-sort-default")){ //check if th is default (no sorting being done so far)
        $columnSelector.removeClass("th-sort-default").addClass("th-sort-asc"); //Always asc on first click
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(1).find("span").eq(0).text().toLowerCase();
            var b = sort_data[j + 1].find("td").eq(1).find("span").eq(0).text().toLowerCase();
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-asc")){ //check if th is in asc sort status
        $columnSelector.removeClass("th-sort-asc").addClass("th-sort-desc"); //If in asc mode, then desc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-s"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(1).find("span").eq(0).text().toLowerCase();
            var b = sort_data[j + 1].find("td").eq(1).find("span").eq(0).text().toLowerCase();
            if (a < b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-desc")){ //check if th is in desc sort status
        $columnSelector.removeClass("th-sort-desc").addClass("th-sort-asc"); //If in desc mode, go back to asc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(1).find("span").eq(0).text().toLowerCase();
            var b = sort_data[j + 1].find("td").eq(1).find("span").eq(0).text().toLowerCase();
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      }
      
      for(var i=0; i<sort_data.length; i++) {
        $columnSelector.closest('table').find('tbody').append(sort_data[i]);
      }
      
      return sort_data;
}

function sortDueDateColumn($columnSelector, array_idx_to_sort_by, sort_data){
      if($columnSelector.hasClass("th-sort-default")){ //check if th is default (no sorting being done so far)
        $columnSelector.removeClass("th-sort-default").addClass("th-sort-asc"); //Always asc on first click
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = new Date(sort_data[j].find("td").eq(2).find(".due-date-field").val().toLowerCase());
            var b = new Date(sort_data[j+1].find("td").eq(2).find(".due-date-field").val().toLowerCase());
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-asc")){ //check if th is in asc sort status
        $columnSelector.removeClass("th-sort-asc").addClass("th-sort-desc"); //If in asc mode, then desc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-s"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = new Date(sort_data[j].find("td").eq(2).find(".due-date-field").val().toLowerCase());
            var b = new Date(sort_data[j+1].find("td").eq(2).find(".due-date-field").val().toLowerCase());
            if (a < b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-desc")){ //check if th is in desc sort status
        $columnSelector.removeClass("th-sort-desc").addClass("th-sort-asc"); //If in desc mode, go back to asc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = new Date(sort_data[j].find("td").eq(2).find(".due-date-field").val().toLowerCase());
            var b = new Date(sort_data[j+1].find("td").eq(2).find(".due-date-field").val().toLowerCase());
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      }
      
      for(var i=0; i<sort_data.length; i++) {
        $columnSelector.closest('table').find('tbody').append(sort_data[i]);
      }
      
      return sort_data;
}

function sortOwnersColumn($columnSelector, array_idx_to_sort_by, sort_data){
      if($columnSelector.hasClass("th-sort-default")){ //check if th is default (no sorting being done so far)
        $columnSelector.removeClass("th-sort-default").addClass("th-sort-asc"); //Always asc on first click
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(3).find(".userListInline").find("li").eq(0).text().toLowerCase();
            var b = sort_data[j+1].find("td").eq(3).find(".userListInline").find("li").eq(0).text().toLowerCase();
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-asc")){ //check if th is in asc sort status
        $columnSelector.removeClass("th-sort-asc").addClass("th-sort-desc"); //If in asc mode, then desc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-s"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(3).find(".userListInline").find("li").eq(0).text().toLowerCase();
            var b = sort_data[j+1].find("td").eq(3).find(".userListInline").find("li").eq(0).text().toLowerCase();
            if (a < b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-desc")){ //check if th is in desc sort status
        $columnSelector.removeClass("th-sort-desc").addClass("th-sort-asc"); //If in desc mode, go back to asc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(3).find(".userListInline").find("li").eq(0).text().toLowerCase();
            var b = sort_data[j+1].find("td").eq(3).find(".userListInline").find("li").eq(0).text().toLowerCase();
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      }
      
      for(var i=0; i<sort_data.length; i++) {
        $columnSelector.closest('table').find('tbody').append(sort_data[i]);
      }
      
      return sort_data;
}

function sortAssigneesColumn($columnSelector, array_idx_to_sort_by, sort_data){
      if($columnSelector.hasClass("th-sort-default")){ //check if th is default (no sorting being done so far)
        $columnSelector.removeClass("th-sort-default").addClass("th-sort-asc"); //Always asc on first click
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(4).find(".userListInline").find("li").eq(0).text().toLowerCase();
            var b = sort_data[j+1].find("td").eq(4).find(".userListInline").find("li").eq(0).text().toLowerCase();
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-asc")){ //check if th is in asc sort status
        $columnSelector.removeClass("th-sort-asc").addClass("th-sort-desc"); //If in asc mode, then desc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-s"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(4).find(".userListInline").find("li").eq(0).text().toLowerCase();
            var b = sort_data[j+1].find("td").eq(4).find(".userListInline").find("li").eq(0).text().toLowerCase();
            if (a < b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-desc")){ //check if th is in desc sort status
        $columnSelector.removeClass("th-sort-desc").addClass("th-sort-asc"); //If in desc mode, go back to asc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(4).find(".userListInline").find("li").eq(0).text().toLowerCase();
            var b = sort_data[j+1].find("td").eq(4).find(".userListInline").find("li").eq(0).text().toLowerCase();
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      }
      
      for(var i=0; i<sort_data.length; i++) {
        $columnSelector.closest('table').find('tbody').append(sort_data[i]);
      }
      
      return sort_data;
}

function sortPriorityColumn($columnSelector, array_idx_to_sort_by, sort_data){
      if($columnSelector.hasClass("th-sort-default")){ //check if th is default (no sorting being done so far)
        $columnSelector.removeClass("th-sort-default").addClass("th-sort-asc"); //Always asc on first click
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(5).find(".priority-field").val();
            var b = sort_data[j+1].find("td").eq(5).find(".priority-field").val();
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-asc")){ //check if th is in asc sort status
        $columnSelector.removeClass("th-sort-asc").addClass("th-sort-desc"); //If in asc mode, then desc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-s"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(5).find(".priority-field").val();
            var b = sort_data[j+1].find("td").eq(5).find(".priority-field").val();
            if (a < b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-desc")){ //check if th is in desc sort status
        $columnSelector.removeClass("th-sort-desc").addClass("th-sort-asc"); //If in desc mode, go back to asc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(5).find(".priority-field").val();
            var b = sort_data[j+1].find("td").eq(5).find(".priority-field").val();
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      }
      
      for(var i=0; i<sort_data.length; i++) {
        $columnSelector.closest('table').find('tbody').append(sort_data[i]);
      }
      
      return sort_data;
}

function sortStatusColumn($columnSelector, array_idx_to_sort_by, sort_data){
      if($columnSelector.hasClass("th-sort-default")){ //check if th is default (no sorting being done so far)
        $columnSelector.removeClass("th-sort-default").addClass("th-sort-asc"); //Always asc on first click
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = -1; //ns = 1, sd = 2, cp = 3, ar = 4
              if(sort_data[j].find("td").eq(6).find(".working-status-field").is(':hidden')){
                if(sort_data[j].find("td").eq(6).find('span').find('a').eq(0).text()==='Archive'){
                  a = 3;
                } else {
                  a = 4;
                }
              } else if(sort_data[j].find("td").eq(6).find(".working-status-field").is(':visible')){
                if(sort_data[j].find("td").eq(6).find(".working-status-field").val()==='ns'){
                  a = 1;
                } else if(sort_data[j].find("td").eq(6).find(".working-status-field").val()==='sd'){
                  a = 2;
                } else if(sort_data[j].find("td").eq(6).find(".working-status-field").val()==='cp'){
                  a = 3;
                }
              }
            var b = -1;
              if(sort_data[j+1].find("td").eq(6).find(".working-status-field").is(':hidden')===true){
                if(sort_data[j+1].find("td").eq(6).find('span').find('a').eq(0).text()==='Archive'){
                  b = 4;
                } else {
                  b = 3;
                }
              } else if(sort_data[j+1].find("td").eq(6).find(".working-status-field").is(':visible')===true){
                if(sort_data[j+1].find("td").eq(6).find(".working-status-field").val()==='ns'){
                  b = 1;
                } else if(sort_data[j+1].find("td").eq(6).find(".working-status-field").val()==='sd'){
                  b = 2;
                } else if(sort_data[j+1].find("td").eq(6).find(".working-status-field").val()==='cp'){
                  b = 3;
                }
              }
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-asc")){ //check if th is in asc sort status
        $columnSelector.removeClass("th-sort-asc").addClass("th-sort-desc"); //If in asc mode, then desc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-s"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = -1; //ns = 1, sd = 2, cp = 3, ar = 4
              if(sort_data[j].find("td").eq(6).find(".working-status-field").is(':hidden')){
                if(sort_data[j].find("td").eq(6).find('span').find('a').eq(0).text()==='Archive'){
                  a = 3;
                } else {
                  a = 4;
                }
              } else if(sort_data[j].find("td").eq(6).find(".working-status-field").is(':visible')){
                if(sort_data[j].find("td").eq(6).find(".working-status-field").val()==='ns'){
                  a = 1;
                } else if(sort_data[j].find("td").eq(6).find(".working-status-field").val()==='sd'){
                  a = 2;
                } else if(sort_data[j].find("td").eq(6).find(".working-status-field").val()==='cp'){
                  a = 3;
                }
              }
            var b = -1;
              if(sort_data[j+1].find("td").eq(6).find(".working-status-field").is(':hidden')===true){
                if(sort_data[j+1].find("td").eq(6).find('span').find('a').eq(0).text()==='Archive'){
                  b = 4;
                } else {
                  b = 3;
                }
              } else if(sort_data[j+1].find("td").eq(6).find(".working-status-field").is(':visible')===true){
                if(sort_data[j+1].find("td").eq(6).find(".working-status-field").val()==='ns'){
                  b = 1;
                } else if(sort_data[j+1].find("td").eq(6).find(".working-status-field").val()==='sd'){
                  b = 2;
                } else if(sort_data[j+1].find("td").eq(6).find(".working-status-field").val()==='cp'){
                  b = 3;
                }
              }
            if (a < b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-desc")){ //check if th is in desc sort status
        $columnSelector.removeClass("th-sort-desc").addClass("th-sort-asc"); //If in desc mode, go back to asc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = -1; //ns = 1, sd = 2, cp = 3, ar = 4
              if(sort_data[j].find("td").eq(6).find(".working-status-field").is(':hidden')){
                if(sort_data[j].find("td").eq(6).find('span').find('a').eq(0).text()==='Archive'){
                  a = 3;
                } else {
                  a = 4;
                }
              } else if(sort_data[j].find("td").eq(6).find(".working-status-field").is(':visible')){
                if(sort_data[j].find("td").eq(6).find(".working-status-field").val()==='ns'){
                  a = 1;
                } else if(sort_data[j].find("td").eq(6).find(".working-status-field").val()==='sd'){
                  a = 2;
                } else if(sort_data[j].find("td").eq(6).find(".working-status-field").val()==='cp'){
                  a = 3;
                }
              }
            var b = -1;
              if(sort_data[j+1].find("td").eq(6).find(".working-status-field").is(':hidden')===true){
                if(sort_data[j+1].find("td").eq(6).find('span').find('a').eq(0).text()==='Archive'){
                  b = 4;
                } else {
                  b = 3;
                }
              } else if(sort_data[j+1].find("td").eq(6).find(".working-status-field").is(':visible')===true){
                if(sort_data[j+1].find("td").eq(6).find(".working-status-field").val()==='ns'){
                  b = 1;
                } else if(sort_data[j+1].find("td").eq(6).find(".working-status-field").val()==='sd'){
                  b = 2;
                } else if(sort_data[j+1].find("td").eq(6).find(".working-status-field").val()==='cp'){
                  b = 3;
                }
              }
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      }
      
      for(var i=0; i<sort_data.length; i++) {
        $columnSelector.closest('table').find('tbody').append(sort_data[i]);
      }
      
      return sort_data;
}

function sortHoursColumn($columnSelector, array_idx_to_sort_by, sort_data){
      if($columnSelector.hasClass("th-sort-default")){ //check if th is default (no sorting being done so far)
        $columnSelector.removeClass("th-sort-default").addClass("th-sort-asc"); //Always asc on first click
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(7).find(".hours-field").val();
            var b = sort_data[j+1].find("td").eq(7).find(".hours-field").val();
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-asc")){ //check if th is in asc sort status
        $columnSelector.removeClass("th-sort-asc").addClass("th-sort-desc"); //If in asc mode, then desc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-s"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(7).find(".hours-field").val();
            var b = sort_data[j+1].find("td").eq(7).find(".hours-field").val();
            if (a < b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      } else if($columnSelector.hasClass("th-sort-desc")){ //check if th is in desc sort status
        $columnSelector.removeClass("th-sort-desc").addClass("th-sort-asc"); //If in desc mode, go back to asc
        $columnSelector.find("div").eq(1).remove();
        $columnSelector.find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
        
        for(var i = 0; i<sort_data.length; i++){
          for (var j = 0; j < sort_data.length-1; j++) {
            var a = sort_data[j].find("td").eq(7).find(".hours-field").val();
            var b = sort_data[j+1].find("td").eq(7).find(".hours-field").val();
            if (a > b) {
              var temp = sort_data[j + 1];
              sort_data[j + 1] = sort_data[j];
              sort_data[j] = temp;
            }
          }
        }
      }
      
      for(var i=0; i<sort_data.length; i++) {
        $columnSelector.closest('table').find('tbody').append(sort_data[i]);
      }
      
      return sort_data;
}

function loadMyCreatedDataTable(){
  $( '.loader').remove(); //Remove any existing loaders
  $( "#data_table tbody" ).after("<div class='loader'>"+
                                             "  <div class='loading-img-txt-box'>"+
                                             "    <img style='padding-top:4px;' src='http://www.bia.gov/cs/groups/webteam/documents/site_assets/idc1-024528.gif' /> <span class='loading-text'>Loading...</span>"+
                                             "  </div>"+
                                             "</div>");
  //initial state for everything
  $( "#my_queue_view_selection" ).val('all');
  $( '#include_archived_checkbox' ).prop('checked', false);
  $( "#data_table thead th:gt(0):lt(7)" ).removeClass("th-sort-asc th-sort-desc").addClass("th-sort-default");
  $( "#data_table thead th:gt(0):lt(7)" ).each(function(i){
    $( this ).find("div").eq(1).remove();
    $( this ).find("div").after('<div style="height: 16px; "></div>');
  });
  $( "#data_table thead" ).find("th").eq(2).removeClass("th-sort-default").addClass("th-sort-asc");
  $( "#data_table thead" ).find("th").eq(2).find("div").eq(1).remove();
  $( "#data_table thead" ).find("th").eq(2).find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
  
  google.script.run.withSuccessHandler(createTable).getMyCreatedTasks("mycreated", "dueDate", "asc");
}

function loadMyAssignedDataTable(){
  $( '.loader').remove(); //Remove any existing loaders
  $( "#my_assigned_data_table tbody" ).after("<div class='loader'>"+
                                             "  <div class='loading-img-txt-box'>"+
                                             "    <img style='padding-top:4px;' src='http://www.bia.gov/cs/groups/webteam/documents/site_assets/idc1-024528.gif' /> <span class='loading-text'>Loading...</span>"+
                                             "  </div>"+
                                             "</div>");
  //initial state for everything
  $( "#my_queue_view_selection" ).val('all');
  $( '#include_archived_checkbox' ).prop('checked', false);
  $( "#my_assigned_data_table thead th:gt(0):lt(7)" ).removeClass("th-sort-asc th-sort-desc").addClass("th-sort-default");
  $( "#my_assigned_data_table thead th:gt(0):lt(7)" ).each(function(i){
    $( this ).find("div").eq(1).remove();
    $( this ).find("div").after('<div style="height: 16px; "></div>');
  });
  $( "#my_assigned_data_table thead" ).find("th").eq(2).removeClass("th-sort-default").addClass("th-sort-asc");
  $( "#my_assigned_data_table thead" ).find("th").eq(2).find("div").eq(1).remove();
  $( "#my_assigned_data_table thead" ).find("th").eq(2).find("div").after('<div><span class="ui-icon ui-icon-carat-1-n"></span></div>');
  google.script.run.withSuccessHandler(createTable).getMyCreatedTasks("myassigned", "dueDate", "asc");
}

function alertMe(obj) {
  userEmailAddress = obj;
}

function getTaskNameTR(readonly_boolean, dataValue, $tableRowColumnSelector, taskLookAndFeel){
  var html="";
  if(readonly_boolean===false){
    html = '<span title="" class="hover_edit_task_name inline-editable">' + dataValue + '</span> <input type="text" class="task-name-field ' + taskLookAndFeel + '" />'; 
  } else {
    html = '<span title="" style="font-weight: bold; padding: 3px;">' + dataValue + '</span> <input type="text" class="hide ' + taskLookAndFeel + '" />';
  }
  $tableRowColumnSelector.html(html);
  $tableRowColumnSelector.find("input").val(dataValue);
}

function getTaskDescriptionTR(readonly_boolean, dataValue, $tableRowColumnSelector, taskLookAndFeel){
  var html="";
  if(readonly_boolean===false){
    var octasck_descript;
    if(dataValue==='' || dataValue===null){ octasck_descript = '<span style="color: blue; text-decoration: underline; cursor: pointer;">Add a description</span>'; }
    else { octasck_descript = dataValue; }
    html = '<br /><div class="hover_edit_task_description" title=""><span class="inline-editable">' + octasck_descript + '</span></div> <textarea rows="6" class="task-description-field ' + taskLookAndFeel + '"></textarea>'; 
  } else {
    html = '<br /><div title=""><span class="inline-editable">' + dataValue + '</span></div> <textarea rows="6" class="hide ' + taskLookAndFeel + '"></textarea>';
  }
  $tableRowColumnSelector.append(html);           
  $tableRowColumnSelector.find("textarea").val(dataValue);
}

function getTaskDueDateTR(readonly_boolean, dataValue, statusValue, $tableRowColumnSelector, taskLookAndFeel){
  var html="";
  if(readonly_boolean===false){
    html = '<input class="due-date-field" type="text" size="7" title="" />'; 
  } else {
    html = '<input class="due-date-field" type="text" size="7" disabled />';
  }
  $tableRowColumnSelector.html(html);     
  $tableRowColumnSelector.find("input").val(dataValue); 
  
  var dataDate = new Date(dataValue);
  if((statusValue === 'sd' || statusValue === 'ns') && today > dataDate) { //Due Date if Overdue   
    $tableRowColumnSelector.append('<div class="alert"><span class="alert-icon ui-icon ui-icon-alert"></span> <span class="alert-icon">Overdue</span></div>');
  } 
}

function getTaskOwnersTR(readonly_boolean, dataValue, $tableRowColumnSelector, taskLookAndFeel){
  var html="";
  var olauncherText = "";
  if(readonly_boolean===false){   
    if(dataValue.length<2){ olauncherText="Add More"; }
    else { 
      if(dataValue.length===2){ olauncherText="and (" + (dataValue.length-1) + ") other."; }
      else { olauncherText="and (" + (dataValue.length-1) + ") others."; }
    }
  } else {
    if(dataValue.length<2){ olauncherText=""; }
    else { 
      if(dataValue.length===2){ olauncherText="and (" + (dataValue.length-1) + ") other."; }
      else { olauncherText="and (" + (dataValue.length-1) + ") others."; }
    }
  }
  $tableRowColumnSelector.html("<ul class='userListInline' style='list-style-type: none; margin: 0; padding:0;'></ul><a class='ownerListManagerLauncher'>" + olauncherText + "</a>");
    var ownerListUl = $tableRowColumnSelector.find(".userListInline");
    for(var k=0; k < dataValue.length; k++){
      if(k===0){ //<-- Owner
        $( '<li></li>' ).html("<span class='user_email_inline' title='" + dataValue[k] + "'>" + normalizeBIAUsernameAbbrevFirstName(dataValue[k]) + "</span>").appendTo( ownerListUl );
      } else { //<-- Delegates
        $( '<li></li>' ).html("<span class='user_email_inline' title='" + dataValue[k] + "'>" + normalizeBIAUsernameAbbrevFirstName(dataValue[k]) + "</span>").hide().appendTo(  ownerListUl );
      }
    }
}

function getTaskAssigneesTR(readonly_boolean, dataValue, $tableRowColumnSelector, taskLookAndFeel){
  var html="";
  var launcherText = "";
  if(readonly_boolean===false){   
    if(dataValue.length<2){ launcherText="Add More"; }
    else { 
      if(dataValue.length===2){ launcherText="and (" + (dataValue.length-1) + ") other."; }
      else { launcherText="and (" + (dataValue.length-1) + ") others."; }
    }
  } else {
    if(dataValue.length<2){ launcherText=""; }
    else { 
      if(dataValue.length===2){ launcherText="and (" + (dataValue.length-1) + ") other."; }
      else { launcherText="and (" + (dataValue.length-1) + ") others."; }
    }
  }
  $tableRowColumnSelector.html("<ul class='userListInline' style='list-style-type: none; margin: 0; padding:0;'></ul><a class='assigneeListManagerLauncher'>" + launcherText + "</a>");
    var assigneeListUl = $tableRowColumnSelector.find(".userListInline");
    for(var k=0; k < dataValue.length; k++){
      if(k===0){ //<-- Lead
        $( '<li></li>' ).html("<span class='user_email_inline' title='" + dataValue[k] + "'>" + normalizeBIAUsernameAbbrevFirstName(dataValue[k]) + "</span>").appendTo( assigneeListUl );
      } else {
        $( '<li></li>' ).html("<span class='user_email_inline' title='" + dataValue[k] + "'>" + normalizeBIAUsernameAbbrevFirstName(dataValue[k]) + "</span>").hide().appendTo(  assigneeListUl );
      }
    }
}

function getTaskPriorityTR(readonly_boolean, dataValue, $tableRowColumnSelector, taskLookAndFeel){
  var html="";
  if(readonly_boolean===false){
    html = '<select class="priority-field"><option value="3">High</option><option value="2">Medium</option><option value="1">Low</option></select>'; 
  } else {
    html = '<select class="priority-field" disabled><option value="3">High</option><option value="2">Medium</option><option value="1">Low</option></select>';
  }
  $tableRowColumnSelector.html(html);     
  $tableRowColumnSelector.find("select").val(dataValue);  
}

function getTaskStatusTR(readonly_boolean, includeArchived_boolean, dataValue, completeDateValue, $tableRowColumnSelector, taskLookAndFeel){
  var html='<select class="working-status-field"><option value="ns">Not Started</option><option value="sd">Started</option><option value="cp">Completed</option>';
  if(readonly_boolean===false && includeArchived_boolean===false){ //<-- Owner/Creator AND Viewing in their My Created/Owned queue
    $tableRowColumnSelector.html(html);     
      if(dataValue==='cp'){ //No Completion Date
        $tableRowColumnSelector.prepend("<strong>Completed on " + completeDateValue + "</strong> <span>(<a class='archive_task_from_row'>Archive</a> | <a class='edit_status_from_row'>Edit</a>)</span>");
        $tableRowColumnSelector.find("select").val(dataValue).hide();
      } else {
        $tableRowColumnSelector.find("select").val(dataValue);
      }
  } else if(readonly_boolean===false && includeArchived_boolean===true){ //<-- Owner/Creator AND Viewing in their search results of My Created/Owned queue
      $tableRowColumnSelector.html(html);  //Status   
        if(dataValue==='cp'){ //No Completion Date
        $tableRowColumnSelector.prepend("<strong>Completed on " + completeDateValue + "</strong> <span>(<a class='archive_task_from_row_search'>Archive</a> | <a class='edit_status_from_row'>Edit</a>)</span>");
        $tableRowColumnSelector.find("select").val(dataValue).hide();
      } else if(dataValue==='ar') { //Archived
        $tableRowColumnSelector.prepend("<strong>Completed on " + completeDateValue + "</strong> <span>(<a class='reopen_status_from_row'>Re-open</a>)</span> ");
        $tableRowColumnSelector.find("select").val(dataValue).hide();
      } else {
        $tableRowColumnSelector.find("select").val(dataValue);
      }
  } else if(readonly_boolean===true && includeArchived_boolean===false){ //<-- Assignee AND Viewing in their My Assigned queue
      $tableRowColumnSelector.html(html);  //Status   
      if(dataValue==='cp'){ //No Completion Date
        $tableRowColumnSelector.prepend("<strong>Completed on " + completeDateValue + "</strong> <span>(<a class='edit_status_from_row'>Edit</a>)</span>");
        $tableRowColumnSelector.find("select").val(dataValue).hide();
      } else {
        $tableRowColumnSelector.find("select").val(dataValue);
      }
  } else if(readonly_boolean===true && includeArchived_boolean===true){ //<-- Assignee AND Viewing in their search results of My Assigned queue
      $tableRowColumnSelector.html(html);  //Status   
      if(dataValue==='cp'){ //No Completion Date
        $tableRowColumnSelector.prepend("<strong>Completed on " + completeDateValue + "</strong> <span>(<a class='edit_status_from_row'>Edit</a>)</span>");
        $tableRowColumnSelector.find("select").val(dataValue).hide();
      } else if(dataValue==='ar') { //Archived
        $tableRowColumnSelector.prepend("<strong>Completed on " + completeDateValue + "</strong> <span>(<a class='reopen_status_from_row'>Re-open</a>)</span>");
        $tableRowColumnSelector.find("select").val(dataValue).hide();
      } else {
        $tableRowColumnSelector.find("select").val(dataValue);
      }
  }
}

function getTaskHoursTR(dataValue, $tableRowColumnSelector, taskLookAndFeel){
  var html='<input class="hours-field" style="text-align:right; width:40px;" />';
  $tableRowColumnSelector.html(html);     
  $tableRowColumnSelector.find("input").val(dataValue);
}

function createTable(scriptDbData) {
  if(scriptDbData.length===0){
    //Update links to show num rows
    $( "#go_my_tasks" ).text("My Tasks (0)"); 
    $( "#go_my_assigned" ).text("My Assignments (0)"); 
  } else {  
    var viewType = "";
    for (var i = 0; i < scriptDbData.length; i++) {  
      var htmlOutput = "";
      var taskId = scriptDbData[i][0];
      var attachmentsArray = scriptDbData[i][6];
      viewType = scriptDbData[i][14];
      var assigneesList_array = scriptDbData[i][3];
      var ownersList_array = scriptDbData[i][13];
      var task_descript = scriptDbData[i][19];
      var data_creation_date = scriptDbData[i][16];
      var data_completion_date = scriptDbData[i][17];  
      var dataDate = new Date(scriptDbData[i][2]);
      if(scriptDbData[i][5] === 'cp') {var taskLookAndFeel = 'completed'; var archivedLF = ''; } 
      else if((scriptDbData[i][5] === 'sd' || scriptDbData[i][5] === 'ns') && today > dataDate){taskLookAndFeel = 'overdue'; archivedLF = '';} 
      else if(scriptDbData[i][5] === 'ar') {var taskLookAndFeel = 'completed'; archivedLF = ' archived';}
      else {taskLookAndFeel = 'incomplete'; archivedLF = '';}
  
      //Rebuild table
      if(viewType==="mycreated" && i===0){ $( "#data_table tbody" ).find("tr").remove(); } 
      else if (viewType === "myassigned" && i===0){ $( "#my_assigned_data_table tbody" ).find("tr").remove(); }
      else if (viewType === "searchassignee" && i===0){ $( "#search_results_assignee_table tbody" ).find("tr").remove(); }
      else if (viewType === "searchcreateown" && i===0){ $( "#search_results_table tbody" ).find("tr").remove(); }
  
      htmlOutput += 
      '  <tr class="' + taskLookAndFeel + archivedLF + ' viewable-tr">'+
      "    <td></td>"+
      "    <td></td>"+
      "    <td align='left'></td>"+
      "    <td align='left'></td>"+
      "    <td align='left'></td>"+
      "    <td align='left'></td>"+
      "    <td align='left'></td>"+
      "    <td align='left'></td>"+
      "    <td align='left'>"+
      "      <div class='attachments-inline'></div>"+
      "    </td>"+
      "    <td align='left'><a class='more_info_link'>More Info</a></td>"+
      "  </tr>";
  
///////////////////////////////////
// Start My Created/Owned table  //
///////////////////////////////////
      if(viewType==="mycreated"){
        var $tableJSelector = $( "#data_table tbody" );
        $( "#data_table tbody" ).append(htmlOutput); //Add row to table
  
        $( "#data_table tbody tr" ).eq(i).find("td").eq(0).html('<input type="checkbox" class="select_task_checkbox" name="own_create_rowid" />'); //*** Check Box *********  
        getTaskNameTR(false, scriptDbData[i][1], $( "#data_table tbody tr" ).eq(i).find("td").eq(1), taskLookAndFeel); //*** Task Name ********* 
        getTaskDescriptionTR(false, task_descript, $( "#data_table tbody tr" ).eq(i).find("td").eq(1), taskLookAndFeel); //*** Task Description ********* 
        getTaskDueDateTR(false, scriptDbData[i][2], scriptDbData[i][5], $( "#data_table tbody tr" ).eq(i).find("td").eq(2), taskLookAndFeel); //*** Due Date
        getTaskOwnersTR(false, ownersList_array, $( "#data_table tbody tr" ).eq(i).find("td").eq(3), taskLookAndFeel); //*** Owners *********
        getTaskAssigneesTR(false, assigneesList_array, $( "#data_table tbody tr" ).eq(i).find("td").eq(4), taskLookAndFeel); //*** Assignees *********
        getTaskPriorityTR(false, scriptDbData[i][4], $( "#data_table tbody tr" ).eq(i).find("td").eq(5), taskLookAndFeel); //*** Priority *********
        getTaskStatusTR(false, true, scriptDbData[i][5], scriptDbData[i][17], $( "#data_table tbody tr" ).eq(i).find("td").eq(6), taskLookAndFeel); //*** Status *********
        getTaskHoursTR(scriptDbData[i][12], $( "#data_table tbody tr" ).eq(i).find("td").eq(7), taskLookAndFeel); //*** Work Hours *********
//*** More info and jq data *********
        buildAttachmentsMarkup($( "#data_table tbody tr" ).eq(i).find("td").eq(8).find(".attachments-inline"), attachmentsArray);
        addJqueryDataToMoreInfo($( "#data_table tbody tr" ).eq(i), taskId, "mycreated", i, attachmentsArray, scriptDbData[i][7], scriptDbData[i][8], scriptDbData[i][9], scriptDbData[i][10], scriptDbData[i][11], scriptDbData[i][13], scriptDbData[i][15], scriptDbData[i][1], scriptDbData[i][2] ,scriptDbData[i][4], data_creation_date, data_completion_date);
      } //*END IF MYCREATED*
///////////////////////////////////
// End of My Created/Owned table //
///////////////////////////////////

///////////////////////////////////
// Start My Assigned table       //
///////////////////////////////////
      else if (viewType === "myassigned"){
        var $tableJSelector = $( "#my_assigned_data_table tbody" );
        $( "#my_assigned_data_table tbody" ).append(htmlOutput); //Add row to table
     
        $( "#my_assigned_data_table tbody tr" ).eq(i).find("td").eq(0).html("<input type='checkbox' class='select_task_checkbox' name='assigned_rowid' />"); //*** Check Box ********* 
        getTaskNameTR(true, scriptDbData[i][1], $( "#my_assigned_data_table tbody tr" ).eq(i).find("td").eq(1), taskLookAndFeel); //*** Task Name ********* 
        getTaskDescriptionTR(true, task_descript, $( "#my_assigned_data_table tbody tr" ).eq(i).find("td").eq(1), taskLookAndFeel); //*** Task Description ********* 
        getTaskDueDateTR(true, scriptDbData[i][2], scriptDbData[i][5], $( "#my_assigned_data_table tbody tr" ).eq(i).find("td").eq(2), taskLookAndFeel); //*** Due Date
        getTaskOwnersTR(true, ownersList_array, $( "#my_assigned_data_table tbody tr" ).eq(i).find("td").eq(3), taskLookAndFeel); //*** Owners *********
        getTaskAssigneesTR(true, assigneesList_array, $( "#my_assigned_data_table tbody tr" ).eq(i).find("td").eq(4), taskLookAndFeel); //*** Assignees *********
        getTaskPriorityTR(true, scriptDbData[i][4], $( "#my_assigned_data_table tbody tr" ).eq(i).find("td").eq(5), taskLookAndFeel); //*** Priority *********
        getTaskStatusTR(true, false, scriptDbData[i][5], scriptDbData[i][17], $( "#my_assigned_data_table tbody tr" ).eq(i).find("td").eq(6), taskLookAndFeel); //*** Status *********
        getTaskHoursTR(scriptDbData[i][12], $( "#my_assigned_data_table tbody tr" ).eq(i).find("td").eq(7), taskLookAndFeel); //*** Work Hours *********
//*** More info and jq data *********
        buildAttachmentsMarkup($( "#my_assigned_data_table tbody tr" ).eq(i).find("td").eq(8).find(".attachments-inline"), attachmentsArray);
        addJqueryDataToMoreInfo($( "#my_assigned_data_table tbody tr" ).eq(i), taskId, "myassigned", i, attachmentsArray, scriptDbData[i][7], scriptDbData[i][8], scriptDbData[i][9], scriptDbData[i][10], scriptDbData[i][11], scriptDbData[i][13], scriptDbData[i][15], scriptDbData[i][1], scriptDbData[i][2] ,scriptDbData[i][4], data_creation_date, data_completion_date);
      } //*END IF MYASSIGNED*
////////////////////////////////////
// End of My Assigned table       //
//////////////////////////////////// 
  
////////////////////////////////////
// Start of Search Assigned table //
//////////////////////////////////// 
      else if(viewType === "searchassignee") {
        var $tableJSelector = $( "#search_results_assignee_table tbody" );
        $( "#search_results_assignee_table tbody" ).append(htmlOutput); //Add row to table

        $( "#search_results_assignee_table tbody tr" ).eq(i).find("td").eq(0).html("<input type='checkbox' class='select_task_checkbox' name='search_rowid' />"); //*** Check Box ********* 
        getTaskNameTR(true, scriptDbData[i][1], $( "#search_results_assignee_table tbody tr" ).eq(i).find("td").eq(1), taskLookAndFeel); //*** Task Name ********* 
        getTaskDescriptionTR(true, task_descript, $( "#search_results_assignee_table tbody tr" ).eq(i).find("td").eq(1), taskLookAndFeel); //*** Task Description ********* 
        getTaskDueDateTR(true, scriptDbData[i][2], scriptDbData[i][5], $( "#search_results_assignee_table tbody tr" ).eq(i).find("td").eq(2), taskLookAndFeel); //*** Due Date
        getTaskOwnersTR(true, ownersList_array, $( "#search_results_assignee_table tbody tr" ).eq(i).find("td").eq(3), taskLookAndFeel); //*** Owners *********
        getTaskAssigneesTR(true, assigneesList_array, $( "#search_results_assignee_table tbody tr" ).eq(i).find("td").eq(4), taskLookAndFeel); //*** Assignees *********
        getTaskPriorityTR(true, scriptDbData[i][4], $( "#search_results_assignee_table tbody tr" ).eq(i).find("td").eq(5), taskLookAndFeel); //*** Priority *********
        getTaskStatusTR(true, true, scriptDbData[i][5], scriptDbData[i][17], $( "#search_results_assignee_table tbody tr" ).eq(i).find("td").eq(6), taskLookAndFeel); //*** Status *********
        getTaskHoursTR(scriptDbData[i][12], $( "#search_results_assignee_table tbody tr" ).eq(i).find("td").eq(7), taskLookAndFeel); //*** Work Hours *********
//*** More info and jq data *********    
        buildAttachmentsMarkup($( "#search_results_assignee_table tbody tr" ).eq(i).find("td").eq(8).find(".attachments-inline"), attachmentsArray);
        addJqueryDataToMoreInfo($( "#search_results_assignee_table tbody tr" ).eq(i), taskId, "myassigned", i, attachmentsArray, scriptDbData[i][7], scriptDbData[i][8], scriptDbData[i][9], scriptDbData[i][10], scriptDbData[i][11], scriptDbData[i][13], scriptDbData[i][15], scriptDbData[i][1], scriptDbData[i][2] ,scriptDbData[i][4], data_creation_date, data_completion_date);
      } //*END IF SEARCHASSIGNEE*
////////////////////////////////////
// End of Search Assigned table   //
//////////////////////////////////// 

//////////////////////////////////////////////
// Start of Search My Owned/Created table   //
//////////////////////////////////////////////
      else if(viewType === "searchcreateown"){
        var $tableJSelector = $( "#search_results_table tbody" );
        $( "#search_results_table tbody" ).append(htmlOutput); //Add row to table

        $( "#search_results_table tbody tr" ).eq(i).find("td").eq(0).html("<input type='checkbox' class='select_task_checkbox' name='search_rowid' />"); //*** Check Box ********* 
        getTaskNameTR(false, scriptDbData[i][1], $( "#search_results_table tbody tr" ).eq(i).find("td").eq(1), taskLookAndFeel); //*** Task Name ********* 
        getTaskDescriptionTR(false, task_descript, $( "#search_results_table tbody tr" ).eq(i).find("td").eq(1), taskLookAndFeel); //*** Task Description ********* 
        getTaskDueDateTR(false, scriptDbData[i][2], scriptDbData[i][5], $( "#search_results_table tbody tr" ).eq(i).find("td").eq(2), taskLookAndFeel); //*** Due Date
        getTaskOwnersTR(false, ownersList_array, $( "#search_results_table tbody tr" ).eq(i).find("td").eq(3), taskLookAndFeel); //*** Owners *********
        getTaskAssigneesTR(false, assigneesList_array, $( "#search_results_table tbody tr" ).eq(i).find("td").eq(4), taskLookAndFeel); //*** Assignees *********
        getTaskPriorityTR(false, scriptDbData[i][4], $( "#search_results_table tbody tr" ).eq(i).find("td").eq(5), taskLookAndFeel); //*** Priority *********
        getTaskStatusTR(false, true, scriptDbData[i][5], scriptDbData[i][17], $( "#search_results_table tbody tr" ).eq(i).find("td").eq(6), taskLookAndFeel); //*** Status *********
        getTaskHoursTR(scriptDbData[i][12], $( "#search_results_table tbody tr" ).eq(i).find("td").eq(7), taskLookAndFeel); //*** Work Hours *********
//*** More info and jq data *********        
        buildAttachmentsMarkup($( "#search_results_table tbody tr" ).eq(i).find("td").eq(8).find(".attachments-inline"), attachmentsArray);
        addJqueryDataToMoreInfo($( "#search_results_table tbody tr" ).eq(i), taskId, "mycreated", i, attachmentsArray, scriptDbData[i][7], scriptDbData[i][8], scriptDbData[i][9], scriptDbData[i][10], scriptDbData[i][11], scriptDbData[i][13], scriptDbData[i][15], scriptDbData[i][1], scriptDbData[i][2] ,scriptDbData[i][4], data_creation_date, data_completion_date);
      } //*END IF SEARCHCREATEOWN*
  //////////////////////////////////////////////
  // End of Search My Owned/Created table     //
  //////////////////////////////////////////////
    } //<-- *END For Loop That builds TRs*
  
//    if(viewType==="mycreated"){ 
//      var $queueTab = $( "#go_my_tasks" ); 
//      updateQueueCount($( "#data_table" ).find("tr").siblings().not('.archived').length, $queueTab, label);
//    } else if (viewType === "myassigned"){ 
//      $queueTab = $( "#go_my_assigned" );
//      updateQueueCount($( "#data_table" ).find("tr").siblings().not('.archived').length, $queueTab, label);
//      updateQueueCount(, $queueTab, "My Assignments");
//    } else if (viewType === "searchassignee"){ 
//      $queueTab = $( "#search_tab" );
//    } else if (viewType === "searchcreateown"){ 
//      $queueTab = $( "#search_tab" );
//    }
  
    //Task Name Edit
    $tableJSelector.find( '.hover_edit_task_name' ).hover(
      function() {
        $( this ).addClass('activate_hover_edit').removeClass('deactivate_hover_edit');
      }, 
      function() {
        $( this ).addClass('deactivate_hover_edit').removeClass('activate_hover_edit');
      })
      .click(function(){
        $(this).hide();
        $(this).next().show().focus();
      })
      .tooltip({
        content: 'Click to edit Task Name',
        tooltipClass: 'table-tooltip',
        position: {
          my: "center bottom",
          at: "center bottom+50",
          using: function( position, feedback ) {
            $( this ).css( position );
            $( "<div>" )
              .addClass( "arrow" )
              .addClass( feedback.vertical )
              .addClass( feedback.horizontal )
              .appendTo( this );
          }
        }
      });
  
    //Save Task Name
    $tableJSelector.find( ".task-name-field" ).change(function(){ 
      var $this = $(this);
      var returnValue = checkForBlankFields($this, "Task Name", $('.top-tips'));
      if(returnValue === true ) {
        $this.addClass('task-name-field').removeClass('task-name-field-highlight');
        var taskid = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").taskId;
        updateTopTips("Saving...");
        google.script.run.withSuccessHandler(updateTopTips).saveTaskNameEdit(taskid, $(this).val());
      } else {
        $this.removeClass('task-name-field').addClass('task-name-field-highlight');
        updateTopTips(returnValue + ' Changes not saved.', 'error');
      }
    })
    .hide()
    .focusout(function(){
      $(this).hide();
      $(this).prev().html($(this).val()).show();
    });
  
    //Task Description edit
    $tableJSelector.find( '.hover_edit_task_description' ).hover(
      function() {
        $( this ).addClass('activate_hover_edit').removeClass('deactivate_hover_edit');
      }, 
      function() {
        $( this ).addClass('deactivate_hover_edit').removeClass('activate_hover_edit');
    })
    .click(function(){
      $(this).hide();
      $(this).next().show().focus();
    })
    .tooltip({
      content: 'Click to edit Task Description',
      tooltipClass: 'table-tooltip',
      position: {
        my: "center bottom",
        at: "center bottom+50",
        using: function( position, feedback ) {
          $( this ).css( position );
          $( "<div>" )
            .addClass( "arrow" )
            .addClass( feedback.vertical )
            .addClass( feedback.horizontal )
            .appendTo( this );
        }
      }
    });
  
    //Save Task Description
    $tableJSelector.find( ".task-description-field" ).change(function(){ 
      var $this = $(this);
      $this.addClass('task-description-field').removeClass('task-description-field-highlight');
      var taskid = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").taskId;
      updateTopTips("Saving...");
      google.script.run.withSuccessHandler(updateTopTips).saveTaskDescriptionEdit(taskid, $(this).val());
    })
    .hide()
    .focusout(function(){
      $(this).hide();
      var octasck_descript = '';
      if($(this).val()==='' || $(this).val()===null){ octasck_descript = '<span style="color: blue; text-decoration: underline; cursor: pointer;">Add a description</span>'; }
      else { octasck_descript = $(this).val(); }
      $(this).prev().html(octasck_descript).show();
    });  
  
    //Save Due Date
    $tableJSelector.find( ".due-date-field" ).hover(
      function() {
        $( this ).addClass('activate_hover_edit').removeClass('deactivate_hover_edit');
      }, 
      function() {
        $( this ).addClass('deactivate_hover_edit').removeClass('activate_hover_edit');
    })
    .datepicker({
      changeMonth: true,
      changeYear: true,
      numberOfMonths: 1
    }).change(function(){
      var $this = $(this);
      var returnValue = checkForBlankFields($this, "Due Date", $('.top-tips'));
      if(returnValue === true ) {
        var newDate = new Date($this.val());
        var isComplete = $this.parent().next().next().next().next().children().html().indexOf('Completed on');
        var alertHtml = '<div class="alert"><span class="alert-icon ui-icon ui-icon-alert"></span> <span class="alert-icon">Overdue</span></div>';
        if(today>newDate && isComplete === -1){
          $(this).parent().closest('tr').removeClass('incomplete').addClass('overdue');
          $(this).parent().prev().children().removeClass('incomplete')
                                            .addClass('overdue');
          if($(this).parent().html().indexOf('class="alert"') === -1) { 
            $(this).parent().append(alertHtml);
          }
        } else if(today<=newDate && isComplete === -1) { 
          $(this).parent().closest('tr').removeClass('overdue').addClass('incomplete');
          $(this).parent().prev().children().removeClass('overdue').addClass('incomplete');
          if($(this).parent().html().indexOf('class="alert"') > -1 && isComplete > -1) { 
            var thingy123 = 'yeah';
          } else {
            $(this).parent().find('.alert').remove();
          }
        }
        var taskid = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").taskId;
        updateTopTips("Saving...");
        google.script.run.withSuccessHandler(updateTopTips).saveTaskDueDateChange(taskid, $(this).val()); 
      } else {
        updateTopTips(returnValue + ' Changes not saved.', 'error');
      }
    })
    .tooltip({
      content: 'Click to edit Due Date',
      tooltipClass: 'table-tooltip',
      position: {
        my: "center bottom",
        at: "center bottom+50",
        using: function( position, feedback ) {
          $( this ).css( position );
          $( "<div>" )
            .addClass( "arrow" )
            .addClass( feedback.vertical )
            .addClass( feedback.horizontal )
            .appendTo( this );
        }
      }
    });

    //Save Assignee
    $tableJSelector.find( ".assignee-field" ).change(function(){
      var $this = $(this);
      var returnValue = checkEmail($(this), "Assignee", $('.top-tips'));
      if (returnValue === true) {
        var taskid = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").taskId;
        updateTopTips("Saving...");
        google.script.run.withSuccessHandler(updateTopTips).saveTaskAssigneeChange(taskid, $(this).val()); 
      } else {
        updateTopTips(returnValue + ' Changes not saved.', 'error');
      }
    });
  
    //Launch user manager - Updated for Sprint 2 - 10/22/2013
    $tableJSelector.find( ".ownerListManagerLauncher, .assigneeListManagerLauncher" ).click(function(){
      var itemHtml = $(this).prev().html();
      var taskId = $(this).parent().closest('tr').find(".attachments-inline").data("attachinfo").taskid;
      var rowid = $(this).parent().closest('tr').find(".attachments-inline").data("attachinfo").rowid;
      var tableType = $(this).parent().closest('tr').find(".attachments-inline").data("attachinfo").table;
      var creator = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").creator;
      var owner = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").owner;
      var dueDate = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").duedate;
      var taskName = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").taskname;
      var priority = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").priority;
      var existingUsersList = new Array();
      var launcherContext = "";
      
      if($(this).prop('class')==='ownerListManagerLauncher'){
        launcherContext = "Owners";
      } else if($(this).prop('class')==='assigneeListManagerLauncher'){
        launcherContext = "Assignees";
      }
    
      $( "#manage-user-list-dialog ol" ).html("");
      $( "#manage-user-list-dialog ol" ).append(itemHtml);
      $( "#manage-user-list-dialog ol" ).find("li").each(function(i){
      //$(this).find("strong").remove(); 
        if(i===0){
          if(launcherContext==="Owners"){
            $(this).show().append(" <span class='lead_user'>(Main Owner)</span> <span class='remove_user_popup' style='color:red;font-size:70%;text-decoration:underline;cursor:pointer;'> (remove)</span>");  
          } else if(launcherContext==="Assignees"){
            $(this).show().append(" <span class='lead_user'>(Lead)</span> <span class='remove_user_popup' style='color:red;font-size:70%;text-decoration:underline;cursor:pointer;'> (remove)</span>");  
          }
        } else {
          $(this).show().append("<span class='remove_user_popup' style='color:red;font-size:70%;text-decoration:underline;cursor:pointer;'> (remove)</span>"); 
        }    
        existingUsersList.push($(this).find(".user_email_inline").prop('title'));
      });
    
      if(tableType==="mycreated"){
        $( "#manage-user-list-dialog" ).dialog('option', 'title', 'Edit ' + launcherContext + ' List');
        $( "#manage-user-list-dialog p" ).text('Please use the list below to manage your ' + launcherContext + ' List:');
        $( "#manage-user-list-dialog ol" ).sortable("enable");
        $( "#manage-user-list-dialog ol" ).find(".remove_user_popup").show();
        $( "#manage-user-list-dialog" ).children().eq(2).show();
        $( "#manage-user-list-dialog" ).children().eq(3).show();
        $( "#user-manager-ok-btn" ).show();
        $( "#user-manager-cancel-btn span" ).text("Cancel");
      } else {
        var collaboratorText = "";
        if(launcherContext==="Owners"){ collaboratorText = "Owners of this task:"; }
        else {  collaboratorText = "Other Collaborators working on this task with you:"; }
        $( "#manage-user-list-dialog" ).dialog('option', 'title', launcherContext + ' List');
        $( "#manage-user-list-dialog p" ).text(collaboratorText);
        $( "#manage-user-list-dialog ol" ).sortable("disable");
        $( "#manage-user-list-dialog ol" ).find(".remove_user_popup").hide();
        $( "#manage-user-list-dialog" ).children().eq(2).hide();
        $( "#manage-user-list-dialog" ).children().eq(3).hide();
        $( "#user-manager-ok-btn" ).hide();
        $( "#user-manager-cancel-btn span" ).text("Close");
      }

      $( ".remove_user_popup" ).click(function(){ $(this).parent().remove(); });
      $( "#manage-user-list-dialog" ).data("dialogdata", {taskid: taskId, rowid: rowid, table: $tableJSelector, creator: creator, owner: owner, 
                                                            existingusers: existingUsersList, duedate: dueDate, taskname: taskName, priority: priority, launcherctx: launcherContext});
      $( "#manage-user-list-dialog" ).dialog( "open" );
    });
  
    //Save Priority
    $tableJSelector.find( ".priority-field" ).change(function(){ 
      var taskid = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").taskId;
      updateTopTips("Saving...");
      google.script.run.withSuccessHandler(updateTopTips).savePriorityChange(taskid, $(this).val()); 
    });
  
    //Save Status
    $tableJSelector.find( ".working-status-field" ).change(function(){ 
      var $this = $(this).val();
      var taskid = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").taskId;
      var rowID = $(this).parent().closest('tr').find(".attachments-inline").data("attachinfo").rowid;
      var activityLogId = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").activityLog;
      var taskName = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").taskname;
      var ownersArray = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").owner;
      if($this === 'cp') {
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1;
        var yyyy = today.getFullYear();
  
        if(mm < 10) { mm = "0"+mm; }
        if(dd < 10) { dd = "0"+dd; }
  
        var mmDDyyyy = mm + '/' + dd + '/' + yyyy;
        $( "#edit-completion-date" ).datepicker({
          changeMonth: true,
          changeYear: true,
          numberOfMonths: 1
        });
        var dateField = $( "#edit-completion-date" ).val(mmDDyyyy);
        $( "#complete-date-dialog" ).dialog( "open" ).data("dialogdata", {taskid: taskid, taskname: taskName, owner: ownersArray, tableSelector: $tableJSelector, status: $this, rowid: rowID, activityLog: activityLogId});      
      } else {
        $(this).parent().closest('tr').find("td").eq(6).children().not("select").remove();
        updateTopTips("Saving...");
        $(this).parent().closest('tr').removeClass('completed').addClass('incomplete');
        $(this).parent().closest('tr').find(".assignee-field, textarea").removeClass('completed').addClass('incomplete');
        google.script.run.withSuccessHandler(updateTopTips).saveStatusChange(taskid, $this);
        google.script.run.saveCompletionDate(taskid, '');
      }
    });
  
    //Archive 
    $tableJSelector.find( ".archive_task_from_row" ).click(function(){ 
      var taskid = $(this).parent().parent().closest('tr').find(".more_info_link").data("moreinfo").taskId;

      updateTopTips("Archiving...");
      $(this).parent().closest('tr').remove();
      google.script.run.withSuccessHandler(updateTopTips).saveStatusChange(taskid, 'ar');
    });
  
    //Archive from Search
    $tableJSelector.find( ".archive_task_from_row_search" ).bind('click', function() {
      var taskid = $(this).parent().parent().closest('tr').find(".more_info_link").data("moreinfo").taskId;
      if($(this).text()==="Archive"){
        updateTopTips("Archiving...");
        $(this).text("Re-open");
        $(this).addClass("reopen_status_from_row");
        $(this).removeClass("archive_task_from_row_search");
        google.script.run.withSuccessHandler(updateTopTips).saveStatusChange(taskid, 'ar');
      } else if($(this).text()==="Re-open") {
        $(this).parent().parent().closest('tr').find("td").eq(6).find("select").show();
        $(this).text("Cancel");
      } else if($(this).text()==="Cancel"){
        $(this).parent().parent().closest('tr').find("td").eq(6).find("select").hide();
        $(this).text("Re-open");
      }
    });
  
    //"Un-complete"
    $tableJSelector.find( ".edit_status_from_row" ).click(function(){ 
      if($(this).text()==="Edit"){
        $(this).parent().parent().closest('tr').find("td").eq(6).find("select").show();
        $(this).text("Cancel");
      } else {
        $(this).parent().parent().closest('tr').find("td").eq(6).find("select").hide();
        $(this).text("Edit");
      }
    });
  
    //Re-open
    $tableJSelector.find( ".reopen_status_from_row" ).bind('click', function() {
      if($(this).text()==="Re-open"){
        $(this).parent().parent().closest('tr').find("td").eq(6).find("select").show();
        $(this).text("Cancel");
      } else {
        $(this).parent().parent().closest('tr').find("td").eq(6).find("select").hide();
        $(this).text("Re-open");
      }
    });
    
    //Save Hours
    $tableJSelector.find( ".hours-field" ).spinner({
      stop: function( event, ui ) {
        var $this = $(this);
        var valueNegative = $this.val().indexOf('-');
        var errorMessage = 'Blank value and letters';
        if($this.val() !== '' && valueNegative === -1) {
          var taskid = $(this).parent().closest('tr').find(".more_info_link").data("moreinfo").taskId;
          updateTopTips("Saving...");
          google.script.run.withSuccessHandler(updateTopTips).saveHoursChange(taskid, $(this).val()); 
        } else {
          if(valueNegative !== -1) {errorMessage = 'Negative numbers'; }
            updateTopTips(errorMessage + ' are not allowed. Changes not saved.', 'error')
          }
      }
    });
    
    $tableJSelector.find( ".more_info_link" ).click(function(){
    //alert("clicked "+$(this).parent().closest('tr').parent().parent().attr("id"));
      var taskid = $(this).data("moreinfo").taskId;
      var creator = $(this).data("moreinfo").creator;
      var ownerVal = $(this).data("moreinfo").owner;
      var requestingOfficeVal = $(this).data("moreinfo").reqOffice;
      var stakeholdersVal = $(this).data("moreinfo").stakeholders;
      var categoryVal = $(this).data("moreinfo").category;
      var keywordsVal = $(this).data("moreinfo").tags;
      var activityLogVal = $(this).data("moreinfo").activityLog;
      var tableSelector_str = $(this).data("moreinfo").table;
      var tableSelector = $(this).data("moreinfo").tableselector;
    
      //SPRINT 2 - 10/22/2013
      //conditionally ACTIVATE fields
      //if($tableJSelector.parent().attr("id")==="my_assigned_data_table"){
      if(userEmailAddress===creator || userEmailAddress ===ownerVal) {
        $( "#more-info-dialog" ).find(".task-owner-field" ).prop('disabled', false).removeClass('disabled-field-sm');
      } else {
        $( "#more-info-dialog" ).find(".task-owner-field" ).prop('disabled', true).addClass('disabled-field-sm');
      }
    
      /**init detail form values**/
      $( ".task-creator-display" ).html(creator);
      $( ".task-owner-field" ).val(ownerVal);
      $( ".req-office-field" ).val(requestingOfficeVal);
      $( ".stakeholders-field" ).val(stakeholdersVal);
      $( ".task-id-display" ).html(taskid);
      if(categoryVal.length===0){ $( "#checkboxes-edit input[type=checkbox]" ).val([]) } else { $( "#checkboxes-edit input[type=checkbox]" ).val(categoryVal) };
      $( ".keyword-edit" ).val(keywordsVal);
      $( ".activity-log-edit" ).val(activityLogVal);
    
      $( "#more-info-dialog" ).data("dialogdata", {rowid: $(this).parent().closest('tr').index(), tableselector: tableSelector, taskowner: ownerVal});
      $( "#more-info-dialog" ).dialog( "open" );
    });
  
    //Add Remove attachment
    $tableJSelector.find( ".add-remove-attach" ).click(function(){    
      var itemHtml = "";
      var taskId = $(this).parent().data("attachinfo").taskid;
      var rowid = $(this).parent().data("attachinfo").rowid;
      var attachmentsArray = $(this).parent().data("attachinfo").attachments_array;
      var tableType = $(this).parent().data("attachinfo").table;
      var tableSelector = $(this).parent().data("attachinfo").tableselector;
  
      for(var i=0; i < attachmentsArray.length; i++){
        itemHtml += "<li><a href='" + attachmentsArray[i][1] + "' target='_blank'>" + attachmentsArray[i][0] + "</a> &nbsp; "+
        "<span class='remove_attachment' style='color:red;font-size:70%;text-decoration:underline;cursor:pointer;'>(remove)</span></li>";
      }
      $( "#doc-manager-dialog ol" ).html("");
      $( "#doc-manager-dialog ol" ).append(itemHtml);
      $( ".remove_attachment" ).click(function(){ $(this).parent().remove(); });
      $( "#doc-manager-dialog" ).data("dialogdata", {taskid: taskId, rowid: rowid, table: tableType, tableselector: tableSelector});
      $( "#doc-manager-dialog" ).dialog( "open" );
    });

  //Reset batch operation logic
  //Export
  $( "#export_menu_btn" ).parent().next().find("li").eq(1).addClass("ui-state-disabled"); $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(1).text("Export Selected Tasks that I Own");
  $( "#export_menu_btn" ).parent().next().find("li").eq(3).addClass("ui-state-disabled"); $( "#export_menu_btn" ).parent().next().find("li").find("a").eq(3).text("Export Selected Tasks Assigned to Me");
  //Edit -> Delete
  $( "#edit_menu_btn" ).parent().next().find("li").eq(0).addClass("ui-state-disabled"); $( "#edit_menu_btn" ).parent().next().find("li").find("a").eq(0).html("<span class='ui-icon ui-icon-trash'></span>Delete");
  
  //Update links to show num rows
//  $( "#go_my_tasks" ).text("My Tasks (" + $( "#data_table tbody tr" ).length + ")"); 
//  $( "#go_my_assigned" ).text("My Assignments (" + $( "#my_assigned_data_table tbody tr" ).length + ")");  
  } //end else
  
  if(viewType==="mycreated"){ 
    var $queueTab = $( "#go_my_tasks" ); 
    //updateQueueCount($( "#data_table" ), $( "#go_my_tasks" ));
    updateQueueCount($( "#data_table tbody" ).find("tr").not('.archived').length, $queueTab, "My Tasks");
  } 
  else if (viewType === "myassigned"){ 
    $queueTab = $( "#go_my_assigned" );
    //updateQueueCount($( "#my_assigned_data_table" ), $( "#go_my_assigned" ));
    updateQueueCount($( "#my_assigned_data_table tbody" ).find("tr").not('.archived').length, $queueTab, "My Assignments");
  }
  else if (viewType === "searchassignee"){ 
    $queueTab = $( "#search_tab" );
  }
  else if (viewType === "searchcreateown"){ 
    $queueTab = $( "#search_tab" );
  }
  //Removing loader class
  $( '.loader').remove();
  
  $( "#search_results_table, #search_results_assignee_table" ).find("tbody").find(".archived").show();
}

  function buildAttachmentsMarkup(tableSelector, attachmentsArray){
    var attachmentsOutput = "";
    if(attachmentsArray.length > 0){
      for(var j=0; j<attachmentsArray.length; j++){ attachmentsOutput += "<a href='" + attachmentsArray[j][1] + "' target='_blank'>" + attachmentsArray[j][0] + "</a>"; if(j!==attachmentsArray.length-1){ attachmentsOutput+=", " } } //loop to get attachments
      tableSelector.html(attachmentsOutput).append( "<button class='add-remove-attach' style='display:block;'>Add/Remove Attachments</button>" );  //Attachments
    } else {
      tableSelector.html("<button class='add-remove-attach' style='display:block;'>Add Attachments</button>");
    }
  }
  
  function addJqueryDataToMoreInfo(tableSelector, taskId, tableSelector_str, iRow, attachmentsArray, reqOffice, category, tags, activityLog, stakeholders, owner, creator, taskName, dueDate, priority, creationDate, completeDate){
    //Add data
    tableSelector.find(".attachments-inline").data("attachinfo", {taskid: taskId, table: tableSelector_str, rowid: iRow, attachments_array: attachmentsArray, tableselector: tableSelector});
    tableSelector.find(".more_info_link").data("moreinfo", {taskId: taskId, table: tableSelector_str, reqOffice: reqOffice, category: category, 
                                                                                tags: tags, activityLog: activityLog, stakeholders: stakeholders, owner: owner, creator: creator,
                                                                                taskname: taskName, duedate: dueDate, priority: priority, tableselector: tableSelector, creationdate: creationDate, completiondate: completeDate});
    tableSelector.find(".export_info_link").data("exportinfo", {taskId: taskId});
  }
  
    function updateTopTips( t,severity ) {
    var topTips = $( ".top-tips" );
    if (severity === undefined) {severity = 'info'; } 
    if (severity === 'info') {
      topTips.text( t ).addClass( "topTips-msg" );
      setTimeout(function() {
        topTips.text('').removeClass("topTips-msg" );
      }, 1700 );
    } else if (severity === 'error' ) {
      topTips.text( t ).addClass( "topTips-error" );
      setTimeout(function() {
        topTips.text('').removeClass("topTips-error" );
      }, 2000 ); 
    }
  }
  
  function formatDatePickerDate(dateIn){
  var year = dateIn.substring(0,4);
  var month = dateIn.substring(5,7);
  var day = dateIn.substring(8,dateIn.length);

  var formattedDate = month + "/" + day + "/" + year;

  return formattedDate;
  }
  /* Not ready for recursive searching right now
  function checkForChildren($selector){
    var searchText = "";
    
    if($selector.children().length > 0) {
      for(var i in $selector.children()){
        if($selector.children().eq(i).is("textarea, input")){
          searchText += $selector.children().eq(i).val() + " ";
        } else {
          searchText += checkForChildren($selector.children().eq(i)) + " ";
        }
      }
    }
    
    searchText += $selector.text();
    
    return searchText;
  }*/
  
  function searchTableText($selector){
    var searchText = "";
    
    if($selector.children().length > 0) {
      for(var i in $selector.children()){
        if($selector.children().eq(i).is("textarea, input, select")){
          searchText += $selector.children().eq(i).val() + " ";
        } else {
          searchText += $selector.children().eq(i).text() + " ";
        }
      }
    }
    
    searchText += $selector.text();
    
    return searchText;
  }
  
  function createTableFilter($filterInput, $tableToFilter, filterLabel_str, autoSuggestions_array, jqDataCol_int, jqDataName_str){
    //Add a label for the filter textbox
    $filterInput.before('<label for="' + $filterInput.attr("id") + '">' + filterLabel_str + '</label>');
    
    $filterInput.autocomplete({
      source: autoSuggestions_array,
      response: function( event, ui ) { 
        //Filter the table rows
        var search_term = $filterInput.val().toUpperCase();
        var view_flag = $( "#my_queue_view_selection" ).data("reportTab");
          
        //Search Text Inside of HTML Table        
        var include_archived_flag = false;
        if($( '#include_archived_checkbox' ).prop('checked')===true){
          include_archived_flag = true;
        }
        if(include_archived_flag===true){
          var $rowsSelector = $tableToFilter.find("tbody").find(".viewable-tr");
        } else {
          $rowsSelector = $tableToFilter.find("tbody").find(".viewable-tr").siblings().not('.archived');
        }
        
        var visible_rows_array = new Array();
        $rowsSelector.each(function(){
          visible_rows_array.push($(this));
        });
        
        //$tableToFilter.find("tbody").find("tr:visible").find("td");
        for(var i=0; i<visible_rows_array.length; i++){
          var matchFlag = false;
          var visible_cols_array = new Array();
          visible_rows_array[i].find("td").each(function(){
            visible_cols_array.push($(this));
          });
          //Check Columns Data First
          for(var j=0; j<visible_cols_array.length; j++){
            if(searchTableText(visible_cols_array[j]).toUpperCase().indexOf(search_term) !== -1){
              matchFlag=true;
              break;
            }
          }
          //Try JQuery Data Second
          if(jqDataCol_int > -1 && matchFlag===false){
            var jqdata = visible_rows_array[i].find("td").eq(jqDataCol_int).find(".more_info_link").data(jqDataName_str);
            
            for (var k in jqdata) {
              //alert(Object.prototype.toString.call(jqdata[k]));
              if(Object.prototype.toString.call(jqdata[k])==="[object String]") { 
                //alert("checking if str " + jqdata[k].toUpperCase() + " matches " + search_term);
                if (jqdata[k].toUpperCase().indexOf(search_term) !== -1) {
                  //alert("found str=str");
                  matchFlag=true;
                  break;
                }
              } else if(Object.prototype.toString.call(jqdata[k])==="[object Array]") {
                if(Object.prototype.toString.call(jqdata[k])==="[object String]") {
                  //alert("checking if arr " + jqdata[k].toUpperCase() + " matches " + search_term);
                  for(var item in jqdata[k]) {
                    if(jqdata[k][item].toUpperCase().indexOf(search_term) !== -1){
                      //alert("found arr=str");
                      matchFlag=true;
                      break;                 
                    }
                  } //end for items in array
                }
              }
            }
          }
          
          if(matchFlag===true){
            visible_rows_array[i].removeClass("filtered-tr-text").show();
          } else {
            visible_rows_array[i].addClass("filtered-tr-text").hide();
          }
        }
        
        $( '.filterer').remove();
        if(view_flag==="mycreated"){ 
          updateQueueCount($tableToFilter.find("tbody").find("tr:visible").length, $( "#go_my_tasks" ), "My Tasks");
        } else if(view_flag==="myassigned") { 
          updateQueueCount($tableToFilter.find("tbody").find("tr:visible").length, $( "#go_my_assigned" ), "My Assignments");
        }
      }
    });
    
    $filterInput.keyup(function() {
      var search_term = $( this ).val();
      var view_flag = $( "#my_queue_view_selection" ).data("reportTab");
      //$( '.loader').remove(); //Remove any existing loaders
      $tableToFilter.find("tbody").after("<div class='filterer'>"+
                                             "  <div class='loading-img-txt-box'>"+
                                             "    <img style='padding-top:4px;' src='http://www.bia.gov/cs/groups/webteam/documents/site_assets/idc1-024528.gif' /> <span class='loading-text'>Filtering...</span>"+
                                             "  </div>"+
                                             "</div>");
        
      if(search_term.length<1){
        var include_archived_flag = false;
        if($( '#include_archived_checkbox' ).prop('checked')===true){
          include_archived_flag = true;
        }
        if(include_archived_flag===true){
          $tableToFilter.find("tbody").find(".viewable-tr").show();
        } else {
          $tableToFilter.find("tbody").find(".viewable-tr").siblings().not('.archived').show();
        }
        $tableToFilter.find("tbody").find(".filtered-tr-text").show();
        $tableToFilter.find("tbody").find("tr").removeClass("filtered-tr-text");
        $( '.filterer').remove();
      }
      
      if(view_flag==="mycreated"){ 
        updateQueueCount($tableToFilter.find("tbody").find("tr:visible").length, $( "#go_my_tasks" ), "My Tasks");
      } else if(view_flag==="myassigned") { 
        updateQueueCount($tableToFilter.find("tbody").find("tr:visible").length, $( "#go_my_assigned" ), "My Assignments");
      }
    });
    
    $filterInput.click(function() {
      var search_term = $( this ).val();
      var view_flag = $( "#my_queue_view_selection" ).data("reportTab");   
   
      if(search_term.length<1){
        var include_archived_flag = false;
        if($( '#include_archived_checkbox' ).prop('checked')===true){
          include_archived_flag = true;
        }
        if(include_archived_flag===true){
          $tableToFilter.find("tbody").find(".viewable-tr").show();
        } else {
          $tableToFilter.find("tbody").find(".viewable-tr").siblings().not('.archived').show();
        }
        
        $tableToFilter.find("tbody").find(".filtered-tr-text").show();
        $tableToFilter.find("tbody").find("tr").removeClass("filtered-tr-text");
      }
      
      if(view_flag==="mycreated"){ 
        updateQueueCount($tableToFilter.find("tbody").find("tr:visible").length, $( "#go_my_tasks" ), "My Tasks");
      } else if(view_flag==="myassigned") { 
        updateQueueCount($tableToFilter.find("tbody").find("tr:visible").length, $( "#go_my_assigned" ), "My Assignments");
      }
    });
  }
</script>